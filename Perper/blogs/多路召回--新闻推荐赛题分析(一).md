[TOC]

# 多路召回--新闻推荐赛题分析(一)

## 前言

这是一个比较大的项目，要做好花一周时间的打算。

零基础入门推荐系统-新闻推荐：https://tianchi.aliyun.com/competition/entrance/531842/introduction

## 推荐系统问题分析的流程

- 问题理解
- 数据分析
- 特征工程
- 召回模块
- 排序模块

## 赛题理解

理解业务逻辑，以及问题的目标有利于构建特征以及后续的模型搭建。

### 赛题简介

这个比赛是新闻推荐场景下的用户行为预测，背景是以新闻app推荐为背景，目的是**要求我们根据用户的历史浏览点击新闻文章的数据信息预测用户未来的点击行为，即用户最后一次点击的文章。**

即：历史点击记录 -> 下一次点击文章

### 数据概况

赛题以预测用户未来点击新闻文章为任务，该数据来自某新闻APP平台的用户交互数据，包括30万用户，近300万次点击，共36万多篇不同的新闻文章，同时每篇新闻文章有对应的embedding向量表示。为了保证比赛的公平性，将会从中抽取20万用户的点击日志数据作为训练集，5万用户的点击日志数据作为测试集A，5万用户的点击日志数据作为测试集B。

**数据表**

`train_click_log.csv`：训练集用户点击日志

`testA_click_log.csv`：测试集用户点击日志

`articles.csv`：新闻文章信息数据表

`articles_emb.csv`：新闻文章embedding向量表示

`sample_submit.csv`：提交样例文件

**字段表**

|       **Field**       |         **Description**          |
| :-------------------: | :------------------------------: |
|        user_id        |              用户id              |
|   click_article_id    |            点击文章id            |
|    click_timestamp    |            点击时间戳            |
|   click_environment   |             点击环境             |
|   click_deviceGroup   |            点击设备组            |
|       click_os        |           点击操作系统           |
|     click_country     |             点击城市             |
|     click_region      |             点击地区             |
|  click_referrer_type  |           点击来源类型           |
|      article_id       | 文章id，与click_article_id相对应 |
|      category_id      |            文章类型id            |
|     created_at_ts     |          文章创建时间戳          |
|      words_count      |             文章字数             |
| emb_1,emb_2,…,emb_249 |      文章embedding向量表示       |

### 评价指标

提交的文件格式为：userID，article1，article2，article3，article4，article5，评分的公式为：
$$
score(user) = \sum_{k=1}^{5}\frac{s(user,k)}{k}
$$
其中k为排名，例如user点击了article2，那么得分为1/2，其他项为0。点击了article3，得到1/3。没有命中为0.因此得分高的指标是，命中率高同时排序高。

### 问题提炼

首先拿到问题的时候，我们第一个应该考虑的是，如何将这一个问题转化为监督学习的问题，这样才能进行网络的搭建和训练。

该赛题的目标是预测用户最后一次点击的文章。乍一想，这是一个超多分类问题，从36w篇文章中找到点击的文章。做这样的大分类存在很多困难。我们将问题进行转化，转化成点击某一篇文章的概率。这样，概率最高的那篇文章就是用户接下来最可能点击的文章。这样这个问题就可以简化成LR逻辑回归的问题。

一个简单的思路如下：

充分交叉，融合特征，使用sigmoid输出一个user embedding，然后利用该embedding去寻找top5相似的article embedding，从而得到推荐的结果。

### itemCF baseline

思路很简单，计算文章之间的相似矩阵，利用用户的历史记录，若用户同时点击a与b，那么有：
$$
a[b] = \frac{1}{\log(len_{history} + 1)}
$$
表示两个item之间的权重，由于物品流行度满足长尾分布，为了让流行度平均值稳定，增加log变换。随后计算a与b之间的cos相似，即a,b同时出现的次数（或log变换后），除以a出现的次数乘上b出现的次数。

随后为每一个用户推荐文章。思路是找到用户的历史浏览记录，然后对每一条记录找到最相似的topk文章，同时这些文章用户之前没有阅读过。如果数量不足就用热门文章替代。然后按照相似度，从大到小排序，返回指定数量的召回文章，即完成工作。

**userCF的思路：**

用用户点击过得article的融合embedding来表示这个用户。然后全量计算和这个用户相似的topN用户。将topN用户中看过的文章，而目标用户没看过的文章筛选出来。然后将相似度作为文章的评分，得到一个排序列表，取出top5作为用户下一次点击的预测结果。



两种方式最后找到recall文章的时候， 都是以用户为中心进行推荐的。



